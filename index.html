<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R Interface to FACTS on Unix-Like Systems â€¢ rfacts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="R Interface to FACTS on Unix-Like Systems">
<meta property="og:description" content="The rfacts package is an R interface to the
  Fixed and Adaptive Clinical Trial Simulator (FACTS)
  on Unix-like systems. It programmatically invokes FACTS to run clinical
  trial simulations, and it aggregates simulation output data
  into tidy data frames. These capabilities provide end-to-end
  automation for large-scale simulation pipelines, and
  they enhance computational reproducibility.
  For more information on FACTS itself,
  please visit &lt;https://www.berryconsultants.com/software/&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rfacts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/config.html">System configuration</a>
    </li>
    <li>
      <a href="articles/generate.html">Generating FACTS files</a>
    </li>
    <li>
      <a href="articles/te.html">Trial execution mode</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EliLillyCo/rfacts">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="rfacts" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rfacts" class="anchor"></a>rfacts</h1></div>

<p>The rfacts package is an R interface to the <a href="https://www.berryconsultants.com/software/">Fixed and Adaptive Clinical Trial Simulator (FACTS)</a> on Unix-like systems. It programmatically invokes <a href="https://www.berryconsultants.com/software/">FACTS</a> to run clinical trial simulations, and it aggregates simulation output data into tidy data frames. These capabilities provide end-to-end automation for large-scale simulation workflows, and they enhance computational reproducibility. For more information, please visit the <a href="https://elilillyco.github.io/rfacts/">documentation website</a>.</p>
<div id="disclaimer" class="section level2">
<h2 class="hasAnchor">
<a href="#disclaimer" class="anchor"></a>Disclaimer</h2>
<p><code>rfacts</code> is not a product of nor supported by <a href="https://www.berryconsultants.com/">Berry Consultants</a>. The code base of <code>rfacts</code> is completely independent from that of <a href="https://www.berryconsultants.com/software/">FACTS</a>, and the former only invokes the latter though dynamic system calls.</p>
</div>
<div id="limitations" class="section level2">
<h2 class="hasAnchor">
<a href="#limitations" class="anchor"></a>Limitations</h2>
<ul>
<li>FACTS files prior to version 6.2.4 are unsupported.</li>
<li>
<code>rfacts</code> only works on Unix-like systems.</li>
<li>
<code>rfacts</code> requires paths to pre-compiled versions of Mono, FLFLL, and the FACTS Linux engines. See the installation instructions below and the <a href="https://elilillyco.github.io/rfacts/articles/config.html">configuration guide</a>.</li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>To install the latest release from CRAN, open R and run the following.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"rfacts"</span><span class="op">)</span></code></pre></div>
<p>To install the latest development version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"EliLillyCo/rfacts"</span><span class="op">)</span></code></pre></div>
<p>Next, set the <code>RFACTS_PATHS</code> environment variable appropriately. For instructions, please see the <a href="https://elilillyco.github.io/rfacts/articles/config.html">configuration guide</a>.</p>
</div>
<div id="run-facts-simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#run-facts-simulations" class="anchor"></a>Run FACTS simulations</h2>
<p>First, create a <code>*.facts</code> XML file using the <a href="https://www.berryconsultants.com/software/">FACTS</a> GUI. The <code>rfacts</code> package has several built-in examples, included with permission from Berry Consultants LLC.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://elilillyco.github.io/rfacts/">rfacts</a></span><span class="op">)</span>

<span class="co"># get_facts_file_example() returns the path to</span>
<span class="co"># an example a FACTS file from rfacts itself.</span>
<span class="co"># For your own FACTS files you create yourself in the FACTS GUI,</span>
<span class="co"># you can skip get_facts_file_example().</span>
<span class="va">facts_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_facts_file_example.html">get_facts_file_example</a></span><span class="op">(</span><span class="st">"contin.facts"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">facts_file</span><span class="op">)</span>
<span class="co">#&gt; [1] "contin.facts"</span></code></pre></div>
<p>Then, run trial simulations with <code><a href="reference/run_facts.html">run_facts()</a></code>. By default, the results are written to a temporary directory. Set the <code>output_path</code> argument to customize the path.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_facts.html">run_facts</a></span><span class="op">(</span>
  <span class="va">facts_file</span>,
  n_sims <span class="op">=</span> <span class="fl">2</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>

<span class="va">out</span>
<span class="co">#&gt; [1] "/tmp/RtmpFv78Hj/file427b6fd72e42"</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="reference/get_csv_files.html">get_csv_files</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "/tmp/RtmpFv78Hj/file427b6fd72e42/contin/acc1_drop1_resp1_params/patients00001.csv"          </span>
<span class="co">#&gt; [2] "/tmp/RtmpFv78Hj/file427b6fd72e42/contin/acc1_drop1_resp1_params/patients00002.csv"          </span>
<span class="co">#&gt; [3] "/tmp/RtmpFv78Hj/file427b6fd72e42/contin/acc1_drop1_resp1_params/weeks_freq_ignore_00001.csv"</span>
<span class="co">#&gt; [4] "/tmp/RtmpFv78Hj/file427b6fd72e42/contin/acc1_drop1_resp1_params/weeks_freq_ignore_00002.csv"</span>
<span class="co">#&gt; [5] "/tmp/RtmpFv78Hj/file427b6fd72e42/contin/acc1_drop1_resp1_params/weeks_freq_locf_00001.csv"  </span>
<span class="co">#&gt; [6] "/tmp/RtmpFv78Hj/file427b6fd72e42/contin/acc1_drop1_resp1_params/weeks_freq_locf_00002.csv"</span></code></pre></div>
<p>Use <code><a href="reference/facts_results.html">read_patients()</a></code> to read and aggregate all the <code>patients*.csv</code> files. <code>rfacts</code> has several such functions, including <code><a href="reference/facts_results.html">read_weeks()</a></code> and <code><a href="reference/facts_results.html">read_mcmc()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/facts_results.html">read_patients</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2,400 x 15</span>
<span class="co">#&gt;    facts_file facts_scenario facts_sim facts_id facts_output facts_csv</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;    </span>
<span class="co">#&gt;  1 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  2 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  3 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  4 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  5 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  6 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  7 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  8 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  9 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; 10 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; # â€¦ with 2,390 more rows, and 9 more variables: facts_header &lt;chr&gt;,</span>
<span class="co">#&gt; #   subject &lt;int&gt;, region &lt;int&gt;, date &lt;dbl&gt;, dose &lt;int&gt;, lastvisit &lt;int&gt;,</span>
<span class="co">#&gt; #   dropout &lt;int&gt;, baseline &lt;lgl&gt;, visit_1 &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="the-simulation-process" class="section level2">
<h2 class="hasAnchor">
<a href="#the-simulation-process" class="anchor"></a>The simulation process</h2>
<p><code><a href="reference/run_facts.html">run_facts()</a></code> has two sequential stages:</p>
<ol>
<li>
<code><a href="reference/run_flfll.html">run_flfll()</a></code>: generate the <code>*.param</code> files and the folder structure for the FACTS Linux engines.</li>
<li>
<code><a href="reference/run_engine.html">run_engine()</a></code>: execute the instructions in the <code>*.param</code> files to conduct trial simulations and produce CSV output.</li>
</ol>
<!-- end list --><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_flfll.html">run_flfll</a></span><span class="op">(</span><span class="va">facts_file</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="reference/run_engine.html">run_engine</a></span><span class="op">(</span><span class="va">facts_file</span>, param_files <span class="op">=</span> <span class="va">out</span>, n_sims <span class="op">=</span> <span class="fl">4</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="reference/facts_results.html">read_patients</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4,800 x 15</span>
<span class="co">#&gt;    facts_file facts_scenario facts_sim facts_id facts_output facts_csv</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;    </span>
<span class="co">#&gt;  1 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  2 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  3 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  4 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  5 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  6 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  7 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  8 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  9 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; 10 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; # â€¦ with 4,790 more rows, and 9 more variables: facts_header &lt;chr&gt;,</span>
<span class="co">#&gt; #   subject &lt;int&gt;, region &lt;int&gt;, date &lt;dbl&gt;, dose &lt;int&gt;, lastvisit &lt;int&gt;,</span>
<span class="co">#&gt; #   dropout &lt;int&gt;, baseline &lt;lgl&gt;, visit_1 &lt;dbl&gt;</span></code></pre></div>
<p><code><a href="reference/run_engine.html">run_engine()</a></code> automatically detects the Linux engine required for your FACTS file. If you know the engine in advance, you can use a specific engine function such as <code><a href="reference/facts_engines.html">run_engine_contin()</a></code> or <code><a href="reference/facts_engines.html">run_engine_dichot()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_flfll.html">run_flfll</a></span><span class="op">(</span><span class="va">facts_file</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="reference/facts_engines.html">run_engine_contin</a></span><span class="op">(</span>param_files <span class="op">=</span> <span class="va">out</span>, n_sims <span class="op">=</span> <span class="fl">4</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="reference/facts_results.html">read_patients</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4,800 x 15</span>
<span class="co">#&gt;    facts_file facts_scenario facts_sim facts_id facts_output facts_csv</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;    </span>
<span class="co">#&gt;  1 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  2 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  3 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  4 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  5 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  6 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  7 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  8 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  9 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; 10 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; # â€¦ with 4,790 more rows, and 9 more variables: facts_header &lt;chr&gt;,</span>
<span class="co">#&gt; #   subject &lt;int&gt;, region &lt;int&gt;, date &lt;dbl&gt;, dose &lt;int&gt;, lastvisit &lt;int&gt;,</span>
<span class="co">#&gt; #   dropout &lt;int&gt;, baseline &lt;lgl&gt;, visit_1 &lt;dbl&gt;</span></code></pre></div>
<p>If you are unsure which engine function to use, call <code><a href="reference/get_facts_engine.html">get_facts_engine()</a></code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/get_facts_engine.html">get_facts_engine</a></span><span class="op">(</span><span class="va">facts_file</span><span class="op">)</span>
<span class="co">#&gt; [1] "run_engine_contin"</span></code></pre></div>
</div>
<div id="run-a-single-scenario" class="section level2">
<h2 class="hasAnchor">
<a href="#run-a-single-scenario" class="anchor"></a>Run a single scenario</h2>
<p>If we take control of the simulation process, we can pick and choose which FACTS simulation scenarios to run and read.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Example FACTS file built into rfacts.</span>
<span class="va">facts_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_facts_file_example.html">get_facts_file_example</a></span><span class="op">(</span><span class="st">"contin.facts"</span><span class="op">)</span>

<span class="co"># Set up the files for the scenarios.</span>
<span class="va">param_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_flfll.html">run_flfll</a></span><span class="op">(</span><span class="va">facts_file</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Each scenario has its own folder with internal parameter files.</span>
<span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_param_dirs.html">get_param_dirs</a></span><span class="op">(</span><span class="va">param_files</span><span class="op">)</span> <span class="co"># not in rfacts &lt;= 1.0.0</span>
<span class="va">scenarios</span>
<span class="co">#&gt; [1] "/tmp/RtmpFv78Hj/file427b68486ae6/contin/acc1_drop1_resp1_params"</span>
<span class="co">#&gt; [2] "/tmp/RtmpFv78Hj/file427b68486ae6/contin/acc1_drop1_resp2_params"</span>
<span class="co">#&gt; [3] "/tmp/RtmpFv78Hj/file427b68486ae6/contin/acc2_drop1_resp1_params"</span>
<span class="co">#&gt; [4] "/tmp/RtmpFv78Hj/file427b68486ae6/contin/acc2_drop1_resp2_params"</span>

<span class="co"># Let's pick one of those scenarios and run the simulations.</span>
<span class="va">scenario</span> <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="fu"><a href="reference/facts_engines.html">run_engine_contin</a></span><span class="op">(</span><span class="va">scenario</span>, n_sims <span class="op">=</span> <span class="fl">2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="reference/facts_results.html">read_patients</a></span><span class="op">(</span><span class="va">scenario</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 600 x 15</span>
<span class="co">#&gt;    facts_file facts_scenario facts_sim facts_id facts_output facts_csv</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;    </span>
<span class="co">#&gt;  1 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  2 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  3 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  4 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  5 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  6 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  7 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  8 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  9 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; 10 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; # â€¦ with 590 more rows, and 9 more variables: facts_header &lt;chr&gt;,</span>
<span class="co">#&gt; #   subject &lt;int&gt;, region &lt;int&gt;, date &lt;dbl&gt;, dose &lt;int&gt;, lastvisit &lt;int&gt;,</span>
<span class="co">#&gt; #   dropout &lt;int&gt;, baseline &lt;lgl&gt;, visit_1 &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="parallel-computing" class="section level2">
<h2 class="hasAnchor">
<a href="#parallel-computing" class="anchor"></a>Parallel computing</h2>
<p>rfacts makes it straightforward to parallelize across simulations. First, use <code><a href="reference/run_flfll.html">run_flfll()</a></code> to create a directory of param files. Be sure to supply an <code>output_path</code> that all the parallel workers can access (e.g.Â no <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code>s).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://elilillyco.github.io/rfacts/">rfacts</a></span><span class="op">)</span>
<span class="va">facts_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_facts_file_example.html">get_facts_file_example</a></span><span class="op">(</span><span class="st">"contin.facts"</span><span class="op">)</span>
<span class="va">param_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"param_files"</span><span class="op">)</span>
<span class="fu"><a href="reference/run_flfll.html">run_flfll</a></span><span class="op">(</span><span class="va">facts_file</span>, <span class="va">param_files</span><span class="op">)</span>
<span class="co">#&gt; [1] "/home/c240390/projects/rfacts/param_files"</span></code></pre></div>
<p>Next, write a custom function that accepts the param files, runs a single simulation for each param file, and returns the important data in memory. Be sure to set a unique seed for each simulation iteration.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_once</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">iter</span>, <span class="va">param_files</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Copy param files to a temp file in order to</span>
  <span class="co"># (1) Avoid race conditions in parallel processing, and</span>
  <span class="co"># (2) Make things run faster: temp files are on local node storage.</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="http://fs.r-lib.org/reference/copy.html">dir_copy</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">param_files</span>, new_path <span class="op">=</span> <span class="va">out</span><span class="op">)</span>
  
  <span class="co"># Run the engine once per param file.</span>
  <span class="fu"><a href="reference/facts_engines.html">run_engine_contin</a></span><span class="op">(</span><span class="va">out</span>, n_sims <span class="op">=</span> <span class="fl">1L</span>, seed <span class="op">=</span> <span class="va">iter</span><span class="op">)</span>
  
  <span class="co"># Return aggregated patients files.</span>
  <span class="fu"><a href="reference/facts_results.html">read_patients</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="co"># Reads fast because `out` is a tempfile().</span>
<span class="op">}</span></code></pre></div>
<p>At this point, we should test this function locally without parallel computing.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co"># All the patients files were named patients00001.csv,</span>
<span class="co"># so do not trust the facts_sim column.</span>
<span class="co"># For data post-processing, use the facts_id column instead.</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="va">sim_once</span>, param_files <span class="op">=</span> <span class="va">param_files</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4,800 x 15</span>
<span class="co">#&gt;    facts_file facts_scenario facts_sim facts_id facts_output facts_csv</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;    </span>
<span class="co">#&gt;  1 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  2 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  3 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  4 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  5 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  6 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  7 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  8 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt;  9 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; 10 contin.faâ€¦ acc1_drop1_reâ€¦         1 file427â€¦ patients     /tmp/Rtmâ€¦</span>
<span class="co">#&gt; # â€¦ with 4,790 more rows, and 9 more variables: facts_header &lt;chr&gt;,</span>
<span class="co">#&gt; #   subject &lt;int&gt;, region &lt;int&gt;, date &lt;dbl&gt;, dose &lt;int&gt;, lastvisit &lt;int&gt;,</span>
<span class="co">#&gt; #   dropout &lt;int&gt;, baseline &lt;lgl&gt;, visit_1 &lt;dbl&gt;</span></code></pre></div>
<p>Parallel computing happens when we call <code>sim_once()</code> repeatedly over several parallel workers. A powerful and convenient parallel computing solution is <a href="https://mschubert.github.io/clustermq/"><code>clustermq</code></a>. Here is a sketch of how to use it with <code>rfacts</code>. <code>mclapply()</code> from the <code>parallel</code> package is a quick and dirty alternative.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Configure clustermq to use our grid and your template file.</span>
<span class="co"># If you are using a scheduler like SGE, you need to write a template file</span>
<span class="co"># like clustermq.tmpl. To learn how, visit</span>
<span class="co"># https://mschubert.github.io/clustermq/articles/userguide.html#configuration-1</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>clustermq.scheduler <span class="op">=</span> <span class="st">"sge"</span>, clustermq.template <span class="op">=</span> <span class="st">"clustermq.tmpl"</span><span class="op">)</span>

<span class="co"># Run the computation.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">clustermq</span><span class="op">)</span>
<span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu">Q</span><span class="op">(</span>
  fun <span class="op">=</span> <span class="va">sim_once</span>,
  iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>,
  const <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">params</span><span class="op">)</span>,
  pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fs"</span>, <span class="st">"rfacts"</span><span class="op">)</span>,
  n_jobs <span class="op">=</span> <span class="fl">4</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Show aggregated patient data.</span>
<span class="va">patients</span></code></pre></div>
<p>Alternatives to <code>clustermq</code> include <code><a href="https://rdrr.io/r/parallel/mclapply.html">parallel::mclapply()</a></code>, <code>furrr::future_map()</code>, and <code>future.apply::future_lapply()</code>.</p>
</div>
<div id="helpers" class="section level2">
<h2 class="hasAnchor">
<a href="#helpers" class="anchor"></a>Helpers</h2>
<p>Various <code>get_facts_*()</code> functions interrogate FACTS files.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/get_facts_scenarios.html">get_facts_scenarios</a></span><span class="op">(</span><span class="va">facts_file</span><span class="op">)</span>
<span class="co">#&gt; [1] "acc1_drop1_resp1" "acc1_drop1_resp2" "acc2_drop1_resp1" "acc2_drop1_resp2"</span>
<span class="fu"><a href="reference/get_facts_version.html">get_facts_version</a></span><span class="op">(</span><span class="va">facts_file</span><span class="op">)</span>
<span class="co">#&gt; [1] "6.2.5.22668"</span>
<span class="fu"><a href="reference/get_facts_versions.html">get_facts_versions</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "6.3.1"   "6.2.5"   "6.0.0.1"</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=rfacts">https://â€‹cloud.r-project.org/â€‹package=rfacts</a>
</li>
<li>Browse source code at <br><a href="https://github.com/EliLillyCo/rfacts/">https://â€‹github.com/â€‹EliLillyCo/â€‹rfacts/â€‹</a>
</li>
<li>Report a bug at <br><a href="https://github.com/EliLillyCo/rfacts/issues">https://â€‹github.com/â€‹EliLillyCo/â€‹rfacts/â€‹issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>William Michael Landau <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1878-3253" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=rfacts"><img src="https://www.r-pkg.org/badges/version/rfacts" alt="cran"></a></li>
<li><a href="https://www.repostatus.org/#active"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="active"></a></li>
<li><a href="https://github.com/EliLillyCo/rfacts/actions?query=workflow%3Acheck"><img src="https://github.com/EliLillyCo/rfacts/workflows/check/badge.svg" alt="check"></a></li>
<li><a href="https://github.com/EliLillyCo/rfacts/actions?query=workflow%3Alint"><img src="https://github.com/EliLillyCo/rfacts/workflows/lint/badge.svg" alt="lint"></a></li>
<li><a href="https://codecov.io/gh/EliLillyCo/rfacts"><img src="https://codecov.io/gh/EliLillyCo/rfacts/branch/main/graph/badge.svg?token=3T5DlLwUVl" alt="codecov"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
